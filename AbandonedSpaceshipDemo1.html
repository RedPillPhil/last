<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0">
		<title>AbandonedSpaceshipDemo1</title>
		<style>
			/* (The rest of your CSS stays the same) */
		</style>
		<link id="-gd-engine-icon" rel="icon" type="image/png" href="AbandonedSpaceshipDemo1.icon.png" />
		<link rel="apple-touch-icon" href="AbandonedSpaceshipDemo1.apple-touch-icon.png"/>
	</head>
	<body>
		<canvas id="canvas">Your browser does not support the canvas tag.</canvas>

		<noscript>
			Your browser does not support JavaScript.
		</noscript>

		<div id="status">
			<img id="status-splash" class="show-image--true fullsize--true use-filter--true" src="AbandonedSpaceshipDemo1.png" alt="">
			<progress id="status-progress"></progress>
			<div id="status-notice"></div>
		</div>

		<script src="AbandonedSpaceshipDemo1.js"></script>
		<script>
const GODOT_CONFIG = {
    "args": [],
    "canvasResizePolicy": 2,
    "ensureCrossOriginIsolationHeaders": true,
    "executable": "AbandonedSpaceshipDemo1",
    "experimentalVK": false,
    "fileSizes": {
        "AbandonedSpaceshipDemo1.pck": 339708384,  // Keep the file size value the same
        "AbandonedSpaceshipDemo1.wasm": 52126319
    },
    "focusCanvas": true,
    "gdextensionLibs": []
};
const GODOT_THREADS_ENABLED = false;
const engine = new Engine(GODOT_CONFIG);

(function () {
    const statusOverlay = document.getElementById('status');
    const statusProgress = document.getElementById('status-progress');
    const statusNotice = document.getElementById('status-notice');

    let initializing = true;
    let statusMode = '';

    function setStatusMode(mode) {
        if (statusMode === mode || !initializing) {
            return;
        }
        if (mode === 'hidden') {
            statusOverlay.remove();
            initializing = false;
            return;
        }
        statusOverlay.style.visibility = 'visible';
        statusProgress.style.display = mode === 'progress' ? 'block' : 'none';
        statusNotice.style.display = mode === 'notice' ? 'block' : 'none';
        statusMode = mode;
    }

    function setStatusNotice(text) {
        while (statusNotice.lastChild) {
            statusNotice.removeChild(statusNotice.lastChild);
        }
        const lines = text.split('\n');
        lines.forEach((line) => {
            statusNotice.appendChild(document.createTextNode(line));
            statusNotice.appendChild(document.createElement('br'));
        });
    }

    function displayFailureNotice(err) {
        console.error(err);
        if (err instanceof Error) {
            setStatusNotice(err.message);
        } else if (typeof err === 'string') {
            setStatusNotice(err);
        } else {
            setStatusNotice('An unknown error occurred.');
        }
        setStatusMode('notice');
        initializing = false;
    }

    const missing = Engine.getMissingFeatures({
        threads: GODOT_THREADS_ENABLED,
    });

    if (missing.length !== 0) {
        // Handle missing features as before
    } else {
        setStatusMode('progress');
        
        // Load the .pck file from the GitHub URL directly
        const pckUrl = "https://github.com/RedPillPhil/last/releases/download/game/AbandonedSpaceshipDemo1.pck";
        
        engine.startGame({
            "onProgress": function (current, total) {
                if (current > 0 && total > 0) {
                    statusProgress.value = current;
                    statusProgress.max = total;
                } else {
                    statusProgress.removeAttribute('value');
                    statusProgress.removeAttribute('max');
                }
            },
            "pckUrl": pckUrl  // Pass the URL of the .pck file here
        }).then(() => {
            setStatusMode('hidden');
        }, displayFailureNotice);
    }
}());
		</script>
	</body>
</html>
